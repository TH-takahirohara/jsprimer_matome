# 関数とスコープ

## クロージャー
- クロージャーは、「外側のスコープにある変数への参照を保持できる」という関数が持つ性質のこと。
- 静的スコープ、メモリ管理の仕組みについての理解が必要。

### 静的スコープ
- どの識別子がどの変数を参照しているかを静的に決定する性質を静的スコープと呼ぶ。
- JavaScriptは静的スコープ。

### 動的スコープ
- 呼び出し元のスコープの変数を参照する仕組みを動的スコープという。
- JavaScriptでもthisという特別なキーワードだけは、呼び出し元によって動的に参照先が変わる。

### メモリ管理の仕組み
- 参照されなくなったデータを開放するメモリ管理の仕組みとしてガベージコレクションがある。
- JavaScriptでは、メモリ管理としてガベージコレクションが採用されている。
- よく誤解されるが、関数の中で作成したデータは、その関数の実行が終了した時点で必ずしも解放されるわけではない。
    - 例：　内部で変数aを定義し、その変数aを戻り値とする関数bがあるとする。関数bの呼び出しを別の変数xに代入した場合、aが参照する値はxからも参照され続けるため、データが自動的に開放されることはない。
- そのデータがメモリ上から開放されるかどうかは、そのデータが参照されているかによって決定されるのである。

### クロージャーがなぜ動くのか
クロージャーは、下記2つの仕組みを利用して、関数内から特定の変数を参照し続けることで関数が状態を持てる仕組みのことを言う。
- 静的スコープ: ある変数がどの値を参照するかは静的に決まる
- メモリ管理の仕組み: 参照されなくなったデータはガベージコレクションにより解放される

### クロージャーの用途
クロージャーはさまざまな用途に利用されますが、次のような用途で利用されることが多い。
- 関数に状態を持たせる手段として
- 外から参照できない変数を定義する手段として
- グローバル変数を減らす手段として
- 高階関数の一部部分として

## まとめ
- 関数やブロックはスコープを持つ
- スコープはネストできる
- もっとも外側にはグローバルスコープがある
- スコープチェーンは内側から外側のスコープへと順番に変数が定義されているか探す仕組みのこと
- varキーワードでの変数宣言やfunctionでの関数宣言では巻き上げが発生する
- クロージャーは静的スコープとメモリ管理の仕組みからなる関数が持つ性質
